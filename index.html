<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>中国語単語</title>
<style>
body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    padding: 20px;
    max-width: 600px;
    margin: 0 auto;
    color: #2c3e50;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
}
h1 {
    font-size: 2.5em;
    margin-bottom: 30px;
    text-align: center;
    color: #34495e;
    text-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
ul {
    list-style-type: none;
    padding: 0;
}
ul li {
    margin-bottom: 15px;
    padding: 15px;
    background: linear-gradient(135deg, #ffffff 0%, #f5f3f0 100%);
    color: #2c3e50;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(52,73,94,0.1);
    border: 1px solid rgba(74,144,226,0.1);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 15px;
}
ul li:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(52,73,94,0.15);
    border-color: rgba(74,144,226,0.3);
}
.word-number {
    background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
    color: white;
    width: 35px;
    height: 35px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 0.9em;
    flex-shrink: 0;
}
.word-content {
    flex: 1;
}
.pronunciation {
    display: inline-block;
    vertical-align: bottom;
    margin-left: 5px;
}
.katakana {
    color: #95a5a6;
    font-size: 0.75em;
    display: block;
    line-height: 1;
    margin-bottom: 2px;
}
.pinyin {
    font-size: 0.9em;
    line-height: 1;
}
button {
    padding: 12px 20px;
    margin-left: 10px;
    font-size: 1em;
    background: linear-gradient(135deg, #4a90e2 0%, #357abd 100%);
    color: #ffffff;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    box-shadow: 0 2px 8px rgba(74,144,226,0.3);
    transition: all 0.3s ease;
    font-weight: 500;
    min-height: 44px; /* iOS推奨のタッチターゲットサイズ */
    min-width: 44px;
    -webkit-tap-highlight-color: transparent;
}
button:hover {
    background: linear-gradient(135deg, #357abd 0%, #2e6da4 100%);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(74,144,226,0.4);
}
button:active {
    transform: translateY(0);
    box-shadow: 0 2px 6px rgba(74,144,226,0.3);
}
button:disabled {
    background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
    cursor: not-allowed;
    transform: none;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.error-message {
    color: #e74c3c;
    font-size: 0.9em;
    margin-top: 8px;
    display: none;
    font-weight: 500;
}
.success-message {
    color: #27ae60;
    font-size: 0.9em;
    margin-top: 8px;
    display: none;
    font-weight: 500;
}
.init-button {
    background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    color: white;
    padding: 15px 30px;
    font-size: 1.1em;
    border: none;
    border-radius: 10px;
    margin: 20px auto;
    display: block;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(231,76,60,0.4);
    transition: all 0.3s ease;
    min-height: 50px;
    -webkit-tap-highlight-color: transparent;
}
.init-button:hover {
    background: linear-gradient(135deg, #c0392b 0%, #a93226 100%);
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(231,76,60,0.5);
}
.init-button:active {
    transform: translateY(0);
}
.init-message {
    text-align: center;
    padding: 20px;
    background: rgba(231,76,60,0.1);
    border: 2px solid rgba(231,76,60,0.3);
    border-radius: 10px;
    margin-bottom: 20px;
    font-weight: 500;
    color: #c0392b;
}
@media (max-width: 600px) {
    body {
        padding: 15px;
    }
    h1 {
        font-size: 2em;
    }
    ul li {
        padding: 12px;
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
    }
    .word-number {
        width: 30px;
        height: 30px;
        font-size: 0.8em;
    }
    .word-content {
        width: 100%;
    }
    button {
        padding: 12px 16px;
        font-size: 0.9em;
        margin-left: 0;
        margin-top: 8px;
        display: block;
        width: 100%;
    }
    .pronunciation {
        display: block;
        margin-left: 0;
        margin-top: 5px;
    }
    .katakana {
        display: block;
        margin-bottom: 1px;
    }
    .pinyin {
        display: block;
    }
}
</style>
</head>
<body>
<h1>中国語単語</h1>

<div id="initSection" style="margin-bottom: 25px;">
    <div class="init-message">
        📱 <strong>iOS/iPhone用：</strong>音声を有効にするために、まず下のボタンをタップしてください
    </div>
    <button class="init-button" id="initAudioBtn">🔊 音声を有効にする</button>
</div>

<div style="margin-bottom: 25px; padding: 15px; background: linear-gradient(135deg, #ffffff 0%, #f5f3f0 100%); color: #2c3e50; border-radius: 10px; border: 1px solid rgba(74,144,226,0.2); box-shadow: 0 2px 8px rgba(52,73,94,0.08);">
    <strong style="color: #4a90e2;">💡 使用方法：</strong>ブラウザの音声合成機能を使用して中国語を読み上げます。
</div>

<ul id="wordsList"></ul>

<script>
const words = [
  {"chinese" : "第" , "pinyin" : "dì" , "katakana" : "ディー" },
  {"chinese" : "一" , "pinyin" : "yī" , "katakana" : "イー" },
  {"chinese" : "课" , "pinyin" : "kè" , "katakana" : "クー" },
  {"chinese" : "你" , "pinyin" : "nǐ" , "katakana" : "ニー" },
  {"chinese" : "叫" , "pinyin" : "jiào" , "katakana" : "ジャオ" },
  {"chinese" : "什么" , "pinyin" : "shénme" , "katakana" : "シェンムー" },
  {"chinese" : "名字" , "pinyin" : "míngzi" , "katakana" : "ミンズー" },
  {"chinese" : "你好" , "pinyin" : "nǐ hǎo" , "katakana" : "ニーハオ" },
  {"chinese" : "老师" , "pinyin" : "lǎoshi" , "katakana" : "ラオシー" },
  {"chinese" : "好" , "pinyin" : "hǎo" , "katakana" : "ハオ" },
  {"chinese" : "我" , "pinyin" : "wǒ" , "katakana" : "ウォー" },
  {"chinese" : "很" , "pinyin" : "hěn" , "katakana" : "ヘン" },
  {"chinese" : "好听" , "pinyin" : "hǎotīng" , "katakana" : "ハオティン" },
  {"chinese" : "谢谢" , "pinyin" : "Xièxie" , "katakana" : "シエシエ" },
  {"chinese" : "是" , "pinyin" : "shì" , "katakana" : "シー" },
  {"chinese" : "中国" , "pinyin" : "Zhōngguó" , "katakana" : "ジョングオ" },
  {"chinese" : "哪个" , "pinyin" : "nǎr" , "katakana" : "ナール" },
  {"chinese" : "人" , "pinyin" : "rén" , "katakana" : "レン" },
  {"chinese" : "苏州" , "pinyin" : "Sūzhōu" , "katakana" : "スージョウ" },
  {"chinese" : "地方" , "pinyin" : "dìfang" , "katakana" : "ディーファン" },
  {"chinese" : "您好" , "pinyin" : "Nín hǎo" , "katakana" : "ニンハオ" },
  {"chinese" : "你们好" , "pinyin" : "Nǐmen hǎo" , "katakana" : "ニーメンハオ" },
  {"chinese" : "大家好" , "pinyin" : "Dàjiā hǎo" , "katakana" : "ダージャーハオ" },
  {"chinese" : "早上好" , "pinyin" : "Zǎoshang hǎo" , "katakana" : "ザオシャンハオ" },
  {"chinese" : "下午好" , "pinyin" : "Xiàwǔ hǎo" , "katakana" : "シャーウーハオ" },
  {"chinese" : "晚上好" , "pinyin" : "Wǎnshang hǎo" , "katakana" : "ワンシャンハオ" },
  {"chinese" : "不" , "pinyin" : "bù" , "katakana" : "ブー" },
  {"chinese" : "不客气" , "pinyin" : "Bú kèqi" , "katakana" : "ブークーチー" },
  {"chinese" : "不用谢" , "pinyin" : "Bú yòng xiè" , "katakana" : "ブーヨンシエ" },
  {"chinese" : "对不起" , "pinyin" : "Duìbuqǐ" , "katakana" : "ドゥイブチー" },
  {"chinese" : "没关系" , "pinyin" : "Méi guānxi" , "katakana" : "メイグアンシー" },
  {"chinese" : "请多关照" , "pinyin" : "Qǐng duō guānzhào" , "katakana" : "チンドゥオグアンジャオ" },
  {"chinese" : "请多指教" , "pinyin" : "Qǐng duō zhǐjiāo" , "katakana" : "チンドゥオジージャオ" },
  {"chinese" : "日本" , "pinyin" : "Rìběn" , "katakana" : "リーベン" },
  {"chinese" : "中国" , "pinyin" : "Zhōngguó" , "katakana" : "ジョングオ" },
  {"chinese" : "韩国" , "pinyin" : "Hánguó" , "katakana" : "ハングオ" },
  {"chinese" : "美国" , "pinyin" : "Měiguó" , "katakana" : "メイグオ" },
  {"chinese" : "英国" , "pinyin" : "Yīngguó" , "katakana" : "インググオ" },
  {"chinese" : "德国" , "pinyin" : "Déguó" , "katakana" : "ドゥーグオ" },
  {"chinese" : "法国" , "pinyin" : "Fǎguó" , "katakana" : "ファーグオ" },
  {"chinese" : "俄罗斯" , "pinyin" : "Éluósī" , "katakana" : "オルオスー" },
  {"chinese" : "您" , "pinyin" : "nín" , "katakana" : "ニン" },
  {"chinese" : "贵姓" , "pinyin" : "guìxìng" , "katakana" : "グイシン" },
  {"chinese" : "哪" , "pinyin" : "nǎ" , "katakana" : "ナー" },
  {"chinese" : "国" , "pinyin" : "guó" , "katakana" : "グオ" }
];

let audioContext;
let audioInitialized = false;

// 音声合成機能の使用可能性をチェック
const speechSynthesisSupported = 'speechSynthesis' in window;

// iOS音声初期化
function initializeAudio() {
    try {
        // AudioContextを作成してiOSの音声を初期化
        if (!audioContext) {
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
        }
        
        // 無音の音声を再生してiOSの制限を解除
        const oscillator = audioContext.createOscillator();
        const gainNode = audioContext.createGain();
        
        oscillator.connect(gainNode);
        gainNode.connect(audioContext.destination);
        
        gainNode.gain.setValueAtTime(0, audioContext.currentTime);
        oscillator.frequency.setValueAtTime(440, audioContext.currentTime);
        oscillator.start();
        oscillator.stop(audioContext.currentTime + 0.01);
        
        // 音声合成も初期化
        if (speechSynthesisSupported) {
            const utterance = new SpeechSynthesisUtterance('');
            utterance.volume = 0;
            speechSynthesis.speak(utterance);
        }
        
        audioInitialized = true;
        document.getElementById('initSection').style.display = 'none';
        
    } catch (error) {
        console.log('Audio initialization error:', error);
    }
}

// 中国語音声を取得する関数
function getChineseVoice() {
    const voices = speechSynthesis.getVoices();
    return voices.find(voice => 
        voice.lang.includes('zh') || 
        voice.name.includes('Chinese') ||
        voice.name.includes('中文') ||
        voice.lang.includes('cmn')
    ) || voices[0];
}

// 音声合成で中国語を読み上げる関数
function speakChinese(text, button, errorDiv, successDiv) {
    if (!speechSynthesisSupported) {
        errorDiv.textContent = '音声合成がサポートされていません';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (!audioInitialized) {
        errorDiv.textContent = '先に「音声を有効にする」ボタンをタップしてください';
        errorDiv.style.display = 'block';
        return;
    }
    
    // 既存の音声を停止
    speechSynthesis.cancel();
    
    button.disabled = true;
    button.textContent = '再生中...';
    errorDiv.style.display = 'none';
    successDiv.style.display = 'none';
    
    // 少し待ってから音声合成を開始（iOS対策）
    setTimeout(() => {
        const utterance = new SpeechSynthesisUtterance(text);
        utterance.lang = 'zh-CN';
        utterance.rate = 0.7;
        utterance.pitch = 1;
        utterance.volume = 1;
        
        // 中国語音声を設定
        const chineseVoice = getChineseVoice();
        if (chineseVoice) {
            utterance.voice = chineseVoice;
        }
        
        utterance.onstart = () => {
            successDiv.textContent = '再生中...';
            successDiv.style.display = 'block';
        };
        
        utterance.onend = () => {
            button.disabled = false;
            button.textContent = '🔊 再生';
            successDiv.textContent = '再生完了';
            setTimeout(() => {
                successDiv.style.display = 'none';
            }, 1500);
        };
        
        utterance.onerror = (event) => {
            button.disabled = false;
            button.textContent = '🔊 再生';
            errorDiv.textContent = '再生エラー: ' + event.error;
            errorDiv.style.display = 'block';
            console.log('Speech synthesis error:', event);
        };
        
        try {
            speechSynthesis.speak(utterance);
        } catch (error) {
            button.disabled = false;
            button.textContent = '🔊 再生';
            errorDiv.textContent = '音声再生に失敗しました';
            errorDiv.style.display = 'block';
            console.log('Speech error:', error);
        }
    }, 100);
}

// 初期化ボタンのイベントリスナー
document.getElementById('initAudioBtn').addEventListener('click', initializeAudio);

const list = document.getElementById('wordsList');

// 音声の読み込み完了を待つ
function createWordList() {
    list.innerHTML = ''; // 既存のリストをクリア
    
    words.forEach((word, index) => {
        const item = document.createElement('li');
        item.innerHTML = `
            <div class="word-number">${index + 1}</div>
            <div class="word-content">
                <div>
                    <strong style="font-size: 1.2em;">${word.chinese}</strong>
                    <span class="pronunciation">
                        <span class="katakana">${word.katakana}</span>
                        <span class="pinyin">(${word.pinyin})</span>
                    </span>
                    <button id="btn-${index}">🔊 再生</button>
                </div>
                <div class="error-message" id="error-${index}"></div>
                <div class="success-message" id="success-${index}"></div>
            </div>
        `;
        
        const button = item.querySelector(`#btn-${index}`);
        const errorDiv = item.querySelector(`#error-${index}`);
        const successDiv = item.querySelector(`#success-${index}`);
        
        button.addEventListener('touchstart', (e) => {
            e.preventDefault();
        }, { passive: false });
        
        button.addEventListener('click', (e) => {
            e.preventDefault();
            speakChinese(word.chinese, button, errorDiv, successDiv);
        });
        
        list.appendChild(item);
    });
}

// ページ読み込み時に音声リストを作成
if (speechSynthesisSupported) {
    speechSynthesis.onvoiceschanged = createWordList;
}

// 初期リスト作成
createWordList();

// タッチイベントの設定（iOS対策）
document.addEventListener('touchstart', function() {}, {passive: true});
</script>
</body>
</html>
